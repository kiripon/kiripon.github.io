<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>自由研究帳 - Data.Sequence と View Pattern</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
	<script type="text/javascript" src="//typesquare.com/accessor/script/typesquare.js?3gh7POzSj-0%3D" charset="utf-8"></script>
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">自由研究帳</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">ABOUT</a>
                <a href="../contact.html">CONTACT</a>
                <a href="../archive.html">ARHCIVE</a>
            </div>
        </div>

        <div id="content">
            <h1>Data.Sequence と View Pattern</h1>

            <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<div class="info">
    Posted on January  5, 2014
    
</div>

<p>C++のdequeに対応するモジュールとして、haskellでは純粋な関数の中で使えるData.Sequenceというモジュールがあります。 内部でFinger Treeというデータ構造を使うことで、左右への要素の追加を償却定数時間で行うことができるようです。 要素の追加には (|&gt;) や (&lt;|) といった演算子を使うことになるのですが、この演算子はコンストラクタではないため、これを用いてパターンマッチをすることができません。 しかしghcにはview patternをいう文法拡張があり、これをつかってパターンマッチをさせることができることを知りました。 <a href="http://www.kotha.net/ghcguide_ja/7.6.2/syntax-extns.html" class="uri">http://www.kotha.net/ghcguide_ja/7.6.2/syntax-extns.html</a></p>
<p>data.sequenceでは予めviewに使える関数が定義されているため自分で定義する必要はありません。</p>
<p>以下のコードでは left と right の定義に使っています。</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE ViewPatterns #-}</span>
<span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>
<span class="co">--seq.hs</span>
<span class="kw">import qualified</span> <span class="dt">Data.Sequence</span> <span class="kw">as</span> <span class="dt">Sq</span>
<span class="kw">import </span><span class="dt">Data.Sequence</span> (<span class="dt">ViewL</span>(..),<span class="dt">ViewR</span>(..),(&gt;&lt;),(&lt;|),<span class="dt">Seq</span>)

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
  <span class="kw">let</span> x <span class="fu">=</span> Sq.empty<span class="ot"> ::</span> <span class="dt">Sq.Seq</span> <span class="dt">Int</span>
  print x
  <span class="kw">let</span> x2 <span class="fu">=</span> <span class="dv">1</span> <span class="fu">&lt;|</span> x
  print x2
  <span class="kw">let</span> x3 <span class="fu">=</span> x2 <span class="fu">&gt;&lt;</span> Sq.fromList [<span class="dv">1</span><span class="fu">..</span><span class="dv">10</span>]
  print x3
  print (right x3)
  print (left x3)

<span class="ot">left ::</span> <span class="dt">Seq</span> a <span class="ot">-&gt;</span> a
left (Sq.viewl <span class="ot">-&gt;</span> (l <span class="fu">:&lt;</span> _)) <span class="fu">=</span> l

<span class="ot">right ::</span> <span class="dt">Seq</span> a <span class="ot">-&gt;</span> a
right (Sq.viewr <span class="ot">-&gt;</span> (_ <span class="fu">:&gt;</span> r)) <span class="fu">=</span> r</code></pre>
<h2 id="実行結果">実行結果</h2>
<pre class="shell"><code>% runhaskell seq.hs
fromList []
fromList [1]
fromList [1,1,2,3,4,5,6,7,8,9,10]
10
1</code></pre>
<p>今年はせめて人並みにhaskellが使えるようになりたいです。精進します。</p>
<h2 id="追記">追記</h2>
<p>パターンガードを使えばガード分の中でパターンマッチが行えます。例えば、</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">left ::</span> <span class="dt">Seq</span> a <span class="ot">-&gt;</span> a
left (Sq.viewl <span class="ot">-&gt;</span> (l <span class="fu">:&lt;</span> _)) <span class="fu">=</span> l</code></pre>
<p>は</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">left ::</span> <span class="dt">Seq</span> a <span class="ot">-&gt;</span> a
left v <span class="fu">|</span> (l <span class="fu">:&lt;</span> _) <span class="ot">&lt;-</span> Sq.viewl v <span class="fu">=</span> l</code></pre>
<p>と書けます。</p>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
